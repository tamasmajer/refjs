let K=(l,n=l)=>{function o(e,t){return t?H(((e,t)=>{let r=w(e)===y?e:[e],n=b(()=>p(r.map(e=>e.val))),o,a;return()=>o===n.val?a:(o=n.val)&&(a=t())})(e,t)):(w(e)===c?H:T)(e)}let i=Object,w=e=>i.getPrototypeOf(e??0),u,f,a,h,s={isConnected:1},G=1e3,t,J={},v=w(s),c=w(w),d,y=w([]),g=(w(""),document),{stringify:p,parse:S}=JSON,r=(e,t,r,n)=>(e??(setTimeout(r,n),new Set)).add(t),_=(e,t,r)=>{var n=a;a=t;try{return e(r)}catch(e){return console.error(e),r}finally{a=n}},x=e=>e.filter(e=>e.t?.isConnected),m=e=>t=r(t,e,()=>{for(var e of t)e.o=x(e.o),e.l=x(e.l);t=d},G),P={get val(){return a?.i?.add(this),this.rawVal},get oldVal(){return a?.i?.add(this),this.u},set val(e){a?.h?.add(this),e!==this.rawVal&&(this.rawVal=e,this.o.length+this.l.length?(f?.add(this),u=r(u,this,R)):this.u=e)},get[n](){return this.val},set[n](e){this.val=e}},T=e=>({__proto__:P,rawVal:e,u:e,o:[],l:[]}),$=(e,t)=>{var r,n,o,a={i:new Set,h:new Set},l={f:e},s=h;h=[];let i=_(e,a,t);w(i)===y?(r=i.map(e=>e?.nodeType?e:new Text(!1===e?"":e??"")),i=k(),e.v&&":"===i.tagName&&(i.v=!0,i.g=t.parentNode??null),O(i,...r)):i=i?.nodeType?i:new Text(!1===i?"":i??"");for(n of a.i)a.h.has(n)||(m(n),n.o.push(l));for(o of h)o.t=i;return h=s,l.t=i},b=(e,t=T(),r)=>{var n,o={i:new Set,h:new Set},a={f:e,s:t};a.t=r??h?.push(a)??s,t.val=_(e,o,t.rawVal);for(n of o.i)o.h.has(n)||(m(n),n.l.push(a));return t},O=(e,...t)=>{t=t.flat(1/0);var r=e.g;if(!r&&1===t.length&&null===t[0]?.g)return t[0].g=e,O(t[0],[...t[0].children]);var n=r?e.g:e;t=r?[...t,e]:t,r&&n.replaceChildren();for(let e of t){var o=w(e),o=o===P?$(()=>e.val):o===c?$(e):e;o!=d&&n.append(o)}return e},V=(s,e)=>{for(let[a,l]of i.entries(e)){let t=e=>e?i.getOwnPropertyDescriptor(e,a)??t(w(e)):d,e=s.tagName+","+a,r=J[e]??=t(w(s))?.set??0,n=a.startsWith("on")?(e,t)=>{var r=a.slice(2);s.removeEventListener(r,t),s.addEventListener(r,e)}:r?r.bind(s):s.setAttribute.bind(s,a),o=w(l);a.startsWith("on")||o===c&&(l=b(l),o=P),o===P?$(()=>(n(l.val,l.u),s)):n(l)}},j=(e,t,...r)=>{1===r.length&&w(r[0])===y&&(r=r[0]);let[{is:n,...o},...a]=w(r[0])===v?r:[{},...r],l=e?.nodeType?e:e?g.createElementNS(e,t,{is:n}):g.createElement(t,{is:n});return V(l,o),O(l,a)},M=e=>e.remove(),N=(e,t)=>e.replaceWith(t),R=()=>{let e=0,t=[...u].filter(e=>e.rawVal!==e.u);do{f=new Set;for(var r of new Set(t.flatMap(e=>e.l=x(e.l))))b(r.f,r.s,r.t),r.t=d}while(++e<100&&(t=[...f]).length);var n,o,a,l,s=[...u].filter(e=>e.rawVal!==e.u);u=d;for(n of new Set(s.flatMap(e=>e.o=x(e.o))))o=n.t,a=$(n.f,n.t),a?a!==o&&N(o,a):M(o),n.t=d;for(l of s)l.u=l.rawVal},U=(e,t,r=E(t,e.content??e))=>r?e=>q(r,e):d,C=r=>({get:(e,t)=>r?.nodeType?U(r,t):j.bind(d,r,t)}),W=new Proxy((e,...t)=>e?.nodeType?q(e,t[0]):new Proxy(j,C(e)),C()),E=(e,t=g)=>""===e||t.matches?.(`[${l}="${e}"]`)?t:(t.content??t).querySelector(`[${l}="${e}"]`),Z=new Proxy({},{get:(e,t)=>{let r=E(t,I);return r?i.assign((...e)=>q(r,e),{[n]:r}):d}}),B=new Proxy({},{get:(e,t)=>{let r=(e=>{for(var t of g.querySelectorAll("template")){if(t.getAttribute(l)===e)return t;t=E(e,t.content??t);if(t)return t}})(t);return r?i.assign((...e)=>q(r,e),{[n]:r}):d}}),L=e=>w(e[0])===v?e:[{},...e],k=()=>g.createElement(":"),q=(e,t)=>{var r,n=e.content,o=n?1===n?.children?.length?n.children[0].cloneNode(1):([...n]=[...n.cloneNode(1).children],O(k(),...n)):e.isConnected?e:e.cloneNode(1),[n,...t]=L(t),a={};if(!t.length)for(let[e,t]of i.entries(n))"a"<=(r=e)[0]&&r[0]<="z"?a[e]=t:(r=E(e,o))&&z(r,t);return z(o,[a,...t]),o!==e&&((n=o).querySelectorAll?.(`[${l}]`).forEach(e=>e.removeAttribute(l)),n.hasAttribute?.(l))&&n.removeAttribute(l),o},z=(e,t)=>{w(t)!==y&&(t=[t]);var r=w(t[0])===v&&t.shift();return 1===t.length&&w(t[0])===c&&(t[0].v=!0,t[0]=$(t[0],k())),r&&V(e,r),t.length&&(r=[t],(t=e).replaceChildren(),O(t,...r)),e},A=new WeakMap,D=(o,a="")=>{A.has(o)||A.set(o,{});let l=A.get(o);return new Proxy({},{get:(e,t)=>{let r=a+t;return l[r]??=(n=T(S(o.getItem(r))),b(()=>o.setItem(r,p(n.val))),n);var n}})},F=(f,h={})=>(e={})=>{let{method:t,headers:r,body:n,query:o,loading:a,p:l,result:s,path:i,url:u}=e={...h,...e};return u=(u||"")+(i||""),o&&(u+=(u.includes("?")?"&":"?")+new URLSearchParams(o)),t||=n?"POST":"GET",r={"Content-Type":"application/json",...r},n=w(n)===v?p(n):n,a?.(u),f(u,{method:t,headers:r,body:n}).then(async e=>e.ok?await e.text().then(e=>{try{e=S(e)}catch{}var t=s?.(e);return t===d?e:t}):l?.({response:e})).catch(e=>l?.({error:e})).finally(()=>a?.())},H=t=>{let r=T(null),n=null;return b(()=>{let e=t();return clearTimeout(n),n=setTimeout(async()=>{r.val=e?.then?await e:e},100),e}),r},e=new Proxy(o,{apply:(e,t,r)=>{var[n,o]=r;return n===window||n?.nodeType?z(n,L(r.slice(1))):n?.getItem&&n?.setItem?D(n,o):"function"==typeof n&&"fetch"===n.name||n===fetch?F(n,o):e(...r)},construct:(e,t)=>K(...t),get:(e,t)=>{return t===n?o:"A"<=(r=t)[0]&&r[0]<="Z"?B[t]||Z[t]:W[t];var r}});var I;return addEventListener("storage",e=>{var t=A.get(localStorage);t?.[e.key]&&(t[e.key].val=S(e.newValue))}),e};export default K("tag");